<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Home - File Server</title>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

    <link rel="stylesheet" th:href="@{/css/themes.css}">
</head>
<body>

<!-- Header -->
<header>
    <h1>Welcome to Your File Server</h1>
    <div class="header-buttons">
        <form action="/logout" method="post" style="margin-right: 1rem;">
            <input type="submit" value="Logout">
        </form>

        <!-- Theme Switcher -->
        <select id="themeSelector">
            <option value="light">Light</option>
            <option value="dark">Dark</option>
            <option value="solarized">Solarized</option>
            <option value="terminal">Terminal green</option>
            <option value="neon">Neon hacker</option>
            <option value="pastel">Pastel candy</option>
        </select>

    </div>

</header>

<!-- Upload/Browse Controls -->
<div class="top-right-controls">
    <form method="post" enctype="multipart/form-data" action="/upload">
        <!--MAKE THIS A POPUP FOR THE FILE UPLOAD -->
        <button type="submit">Upload</button>
    </form>
    <form action="/browse" method="get">
        <button type="submit">Browse</button>
    </form>
</div>

<!-- Main Layout -->
<div class="main-layout">
    <!-- Left Sidebar -->
    <div class="sidebar">
        <h2>Disk Usage</h2>
        <canvas id="diskChart"></canvas>

        <ul>
            <li>Total: <span th:text="${total}">0</span> GB</li>
            <li>Free: <span th:text="${free}">0</span> GB</li>
            <li>Used: <span th:text="${used}">0</span> GB</li>
        </ul>

        <div class="progress-bar">
            <div class="progress-bar-fill"
                 th:style="'width:' + ${percentUsed} + '%'">
                <span th:text="${percentUsed.intValue()} + '%'">0%</span>
            </div>
        </div>

        <h3>Mounted Partitions</h3>
        <ul>
            <li th:each="part : ${partitions}" th:text="${part}">/mnt/placeholder</li>
        </ul>
    </div>

    <!-- Center + Right Panels -->
    <div class="content">
        <div class="center-panel">
            <h2>Directory Viewer</h2>
            <div class="file-explorer">
                <table>
                    <thead>
                    <tr>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Size</th>
                        <th>Last Modified</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- Example static rows. Replace with dynamic Thymeleaf loop -->
                    <tr>
                        <td><span class="icon">üìÅ</span> <a href="#" th:href="@{/browse?path=/Documents}">Documents</a></td>
                        <td>Folder</td>
                        <td>‚Äî</td>
                        <td>2025-10-19 14:35</td>
                    </tr>
                    <tr>
                        <td><span class="icon">üìÑ</span> <a href="#" th:href="@{/download?file=/notes.txt}">notes.txt</a></td>
                        <td>File</td>
                        <td>12 KB</td>
                        <td>2025-10-19 09:12</td>
                    </tr>
                    <!-- More rows dynamically inserted -->
                    </tbody>
                </table>
            </div>


            <p>Placeholder for folder tree or contents.</p>
        </div>
        <div class="right-panel">
            <h2>File Details / Preview</h2>
            <p>Placeholder for selected file info or preview.</p>
        </div>
    </div>
</div>

<!-- Footer -->
<footer>
    &copy; 2025 Local File Server
</footer>




<script th:inline="javascript">
    /*<![CDATA[*/

    const usedSpace = [[${usedRaw}]];
    const freeSpace = [[${freeRaw}]];

    window.usedGB = usedSpace;
    window.freeGB = freeSpace;

    let diskChart = null;

    function renderDiskChart() {
        const rootStyle = getComputedStyle(document.documentElement);
        const colorUsed = rootStyle.getPropertyValue('--color-used').trim();
        const colorFree = rootStyle.getPropertyValue('--color-free').trim();
        const colorUsedBorder = rootStyle.getPropertyValue('--color-used-border').trim();
        const colorFreeBorder = rootStyle.getPropertyValue('--color-free-border').trim();

        const ctx = document.getElementById('diskChart').getContext('2d');

        // Destroy old chart if it exists
        if (diskChart) {
            diskChart.destroy();
        }

        // Create new chart
        diskChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['Used Space', 'Free Space'],
                datasets: [{
                    data: [window.usedGB, window.freeGB],
                    backgroundColor: [colorUsed, colorFree],
                    borderColor: [colorUsedBorder, colorFreeBorder],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'bottom' },
                    title: {
                        display: true,
                        text: 'Disk Usage (in GB)'
                    },
                    datalabels: {
                        color: '#fff',
                        formatter: (value) => value.toFixed(1) + ' GB',
                        font: {
                            weight: 'bold',
                            size: 14
                        }
                    }
                }
            },
            plugins: [ChartDataLabels]
        });
    }

    // Initial render
    renderDiskChart();

    /*]]>*/
</script>


<script>
    const themeSelector = document.getElementById('themeSelector');
    const htmlEl = document.documentElement;

    const savedTheme = localStorage.getItem('theme') || 'solarized';
    htmlEl.setAttribute('data-theme', savedTheme);
    themeSelector.value = savedTheme;

    themeSelector.addEventListener('change', function () {
        const selectedTheme = this.value;
        htmlEl.setAttribute('data-theme', selectedTheme);
        localStorage.setItem('theme', selectedTheme);

        // Wait for CSS to apply before re-rendering chart
        setTimeout(() => {
            if (typeof renderDiskChart === 'function') {
                renderDiskChart();
            }
        }, 50); // slight delay ensures CSS variables have changed
    });
</script>


</body>
</html>
